function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Watcher=function(){function e(t,n,i){_classCallCheck(this,e),this.$vm=t,this.$key=n,this.$cb=i,Dep.target=this,this.oldValue=this.getValue(this.$vm,this.$key),Dep.target=null}return _createClass(e,[{key:"update",value:function(){var e=this.getValue(this.$vm,this.$key);this.$cb(e)}},{key:"getValue",value:function(e,t){var n=e.$data;return t.split(".").map(function(e){n=n[e]}),n}}]),e}(),Dep=function(){function e(){_classCallCheck(this,e),this.subs=[]}return _createClass(e,[{key:"addSub",value:function(e){this.subs.push(e)}},{key:"notify",value:function(){this.subs,this.subs.map(function(e){e.update()})}}]),e}(),observer=function(){function e(t,n){return _classCallCheck(this,e),this.walk(t,n)}return _createClass(e,[{key:"walk",value:function(e,t){var n=new Dep,i={get:function(e,t,a){Dep.target&&n.addSub(Dep.target);try{return new Proxy(e[t],i)}catch(n){return Reflect.get(e,t,i)}},set:function(e,t,i,a){return Reflect.set(e,t,i,a),n.notify(),!0}};return new Proxy(e,i)}}]),e}(),Compile=function(){function e(t,n){if(_classCallCheck(this,e),this.el="string"==typeof t?document.querySelector(t):t,this.vm=n,this.el){var i=this.node2fragment(this.el);this.compile(i),this.el.appendChild(i)}}return _createClass(e,[{key:"node2fragment",value:function(e){var t=document.createDocumentFragment(),n=e.childNodes;return Array.from(n).map(function(e){t.appendChild(e)}),t}},{key:"compile",value:function(e){var t=this,n=e.childNodes;Array.from(n).map(function(e,n){t.isElementNode(e)?t.compileElement(e):t.isText(e)&&t.textCompile(e),e&&e.childNodes.length&&t.compile(e)})}},{key:"compileElement",value:function(e){var t=this,n=e.attributes;Array.from(n).map(function(n){var i=n.name;if(t.isDirective(i)){var a=i.split("-")[1];CompileUtil[a]&&CompileUtil[a](e,n.nodeValue,t.vm)}var r=t.isEventDirective(i);r&&CompileUtil.eventHandler(t.vm,e,r[1],n.nodeValue)})}},{key:"textCompile",value:function(e){var t=this,n=this.newMethod(e);if(/\{\{((.|\n)+?)\}\}/g.test(n)){var i=RegExp.$1.trim();e.textContent=CompileUtil.getValue(this.vm,i),new Watcher(this.vm,i,function(n){e.textContent=CompileUtil.getValue(t.vm,i)})}}},{key:"newMethod",value:function(e){return e.textContent}},{key:"isElementNode",value:function(e){return 1===e.nodeType}},{key:"isText",value:function(e){return 3===e.nodeType}},{key:"isDirective",value:function(e){return e.startsWith("v-")}},{key:"isEventDirective",value:function(e){return/^(?:(?:v-on:)|@)([a-zA-Z_]\w*)/.exec(e)}}]),e}(),CompileUtil={text:function(e,t,n){var i=this;e.textContent=this.getValue(n,t),new Watcher(n,t,function(){e.textContent=i.getValue(n,t)})},html:function(e,t,n){var i=this;e.innerHTML=this.getValue(n,t),new Watcher(n,t,function(){e.innerHTML=i.getValue(n,t)})},model:function(e,t,n){var i=this;"input"===e.localName&&(e.value=this.getValue(n,t),new Watcher(n,t,function(){e.value=i.getValue(n,t)}),window.addEventListener("input",function(e){var a=e.target;i.setValue(n,t,a.value)}))},eventHandler:function(e,t,n,i){var a=e.methods[i];t.addEventListener(n,a.bind(e))},show:function(e,t,n){this.getValue(n,t)||(e.style.display="none")},getValue:function(e,t){var n=e.$data;return t.split(".").map(function(e){n=n[e]}),n},setValue:function(e,t,n){var i=e.$data,a=t.split(".");a.map(function(e,t){t<a.length-1?i=i[e]:i[e]=n})}},vue=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.$el=t.el,this._data=t.data,this.methods=t.methods,this.init(t.data)}return _createClass(e,[{key:"init",value:function(e){this.$data=new observer(e),new Compile(this.$el,this)}}]),e}();
